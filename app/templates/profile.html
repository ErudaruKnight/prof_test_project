<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Личный профиль</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <a class="navbar-brand" href="{{ url_for('main.index') }}">ProfTest</a>
  <ul class="navbar-nav ml-auto">
    <li class="nav-item"><a class="nav-link" href="{{ url_for('calc.ege_calculator') }}">Калькулятор ЕГЭ</a></li>
    <li class="nav-item"><a class="nav-link" href="{{ url_for('main.profile') }}">Профиль</a></li>
    <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.logout') }}">Выйти</a></li>
  </ul>
</nav>
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center">
    <h2 class="mb-0">Профиль пользователя</h2>
    <div>
      <a class="btn btn-success" href="{{ url_for('main.index') }}">К списку тестов</a>
      <a class="btn btn-primary ml-2" href="{{ url_for('main.career_test') }}">Пройти тест</a>
    </div>
  </div>
  <p class="mt-3"><strong>{{ current_user.full_name or current_user.username }}</strong></p>
  <p>Баллы ЕГЭ: Математика — {{ current_user.ege_math or '—' }}, Русский — {{ current_user.ege_russian or '—' }}, Физика — {{ current_user.ege_physics or '—' }}</p>
  <h4 class="mt-4">Результаты тестов</h4>
  {% if results %}
  <ul class="list-group">
    {% for entry in results %}
    {% set r = entry.result %}
    <li class="list-group-item">
      <strong>{{ r.test.title }}</strong>
      <small class="text-muted">{{ r.timestamp.strftime('%Y-%m-%d') }}</small>
      {% if entry.data %}
        <p class="mt-2 mb-1">Рекомендуемое направление: {{ entry.data.recommended or 'Не определено' }}</p>
        <table class="table table-sm mb-0">
          <thead><tr><th>Направление</th><th>Баллы</th></tr></thead>
          <tbody>
            {% for direction, score in entry.data.scores %}
            <tr><td>{{ direction }}</td><td>{{ score }}</td></tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="mt-2">{{ r.result_text }}</div>
      {% endif %}
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <p>Результаты отсутствуют.</p>
  {% endif %}
</div>
</body>
</html>